<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"] â€” Agar.IA Admin</title>
    <link href="~/dist/admin.css" rel="stylesheet" />
    @RenderSection("Styles", false)
</head>
<body class="bg-base-200 min-h-screen">
    <div id="main-drawer" class="drawer lg:drawer-open">
        <input id="drawer-toggle" type="checkbox" class="drawer-toggle" />

        <div class="drawer-content flex flex-col">
            <!-- Top navbar -->
            <div class="navbar bg-base-100 border-b border-base-200 px-4 lg:px-6 sticky top-0 z-30">
                <div class="flex-none lg:hidden">
                    <label for="drawer-toggle" class="btn btn-square btn-ghost">
                        <icon name="bars-3" size="5" />
                    </label>
                </div>
                <div class="flex-none hidden lg:block">
                    <button id="sidebar-expand" type="button" class="btn btn-square btn-ghost hidden" title="Expand sidebar">
                        <icon name="bars-3" size="5" />
                    </button>
                </div>
                <!-- Page title -->
                <h1 class="text-lg font-medium flex items-center gap-2 ml-2 truncate">
                    @Html.Raw(ViewData["Icon"])
                    <span class="hidden sm:inline">@ViewData["Title"]</span>
                </h1>
                <div class="flex-1"></div>
                <!-- Page actions -->
                <div class="flex items-center gap-2">
                    @RenderSection("PageActions", false)
                </div>
                <div class="border-l border-base-300 h-8 mx-4"></div>
                <div class="flex items-center gap-3">
                    <button id="theme-toggle" type="button" class="btn btn-ghost btn-sm btn-square" title="Toggle dark mode">
                        <icon name="sun" size="5" class="theme-icon-sun !hidden" />
                        <icon name="moon" size="5" class="theme-icon-moon" />
                    </button>
                </div>
            </div>

            <!-- Page content -->
            <main class="flex-1 p-4 lg:p-6">
                <partial name="_FlashMessages" />
                <div class="card bg-base-100 shadow-sm">
                    <div class="card-body p-4 lg:p-6">
                        @RenderBody()
                    </div>
                </div>
            </main>
        </div>

        <!-- Sidebar -->
        <div class="drawer-side z-40">
            <label for="drawer-toggle" aria-label="close sidebar" class="drawer-overlay"></label>
            <aside class="bg-base-100 w-64 min-h-screen flex flex-col border-r border-base-200">
                <!-- Logo -->
                <div class="p-4 flex items-center justify-between">
                    <a asp-controller="Dashboard" asp-action="Index" class="text-xl font-bold">Agar.IA Admin</a>
                    <button id="sidebar-collapse" type="button" class="btn btn-ghost btn-sm btn-square hidden lg:flex" title="Collapse sidebar">
                        <icon name="chevron-double-left" size="5" />
                    </button>
                </div>

                <!-- Navigation menu -->
                <nav class="flex-1 overflow-y-auto px-3 py-4">
                    <ul class="menu w-full p-0 gap-1 [&_li>*]:gap-3">
                        <li>
                            <a asp-controller="Dashboard" asp-action="Index"
                               class="text-sm @(ViewData["Menu"]?.ToString() == "Dashboard" ? "active font-medium" : "font-normal")">
                                <icon name="home" size="4" />
                                Dashboard
                            </a>
                        </li>
                        <li>
                            <a asp-controller="Training" asp-action="Index"
                               class="text-sm @(ViewData["Menu"]?.ToString() == "Training" ? "active font-medium" : "font-normal")">
                                <icon name="academic-cap" size="4" />
                                Training
                            </a>
                        </li>
                        <li>
                            <a asp-controller="Settings" asp-action="Index"
                               class="text-sm @(ViewData["Menu"]?.ToString() == "Settings" ? "active font-medium" : "font-normal")">
                                <icon name="cog-6-tooth" size="4" />
                                Settings
                            </a>
                        </li>
                        <li>
                            <a asp-controller="History" asp-action="Index"
                               class="text-sm @(ViewData["Menu"]?.ToString() == "History" ? "active font-medium" : "font-normal")">
                                <icon name="clock" size="4" />
                                Game History
                            </a>
                        </li>
                    </ul>
                </nav>

                <!-- User info bar -->
                <div class="p-3 border-t border-base-200">
                    <div class="flex items-center gap-3 p-2">
                        <div class="avatar placeholder">
                            <div class="bg-neutral text-neutral-content w-10 rounded-full flex items-center justify-center">
                                <span>A</span>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="text-sm font-medium truncate">Admin</div>
                        </div>
                        <div class="dropdown dropdown-top dropdown-end">
                            <div tabindex="0" role="button" class="btn btn-ghost btn-sm btn-square">
                                <icon name="ellipsis-vertical" size="5" />
                            </div>
                            <ul tabindex="0" class="dropdown-content menu bg-base-100 rounded-box z-50 w-52 p-2 shadow-lg border border-base-200 mb-2">
                                <li>
                                    <a asp-controller="Account" asp-action="ChangePassword">
                                        <icon name="key" size="4" /> Change Password
                                    </a>
                                </li>
                                <li>
                                    <a asp-controller="Auth" asp-action="Logout">
                                        <icon name="arrow-right-on-rectangle" size="4" /> Logout
                                    </a>
                                </li>
                                <li>
                                    <a href="/" target="_blank">
                                        <icon name="arrow-top-right-on-square" size="4" /> Back to Game
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <script>
        // Theme
        function applyTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            var isDark = theme === 'dark';
            document.querySelectorAll('.theme-icon-sun').forEach(function(el) { el.classList.toggle('!hidden', !isDark); });
            document.querySelectorAll('.theme-icon-moon').forEach(function(el) { el.classList.toggle('!hidden', isDark); });
        }

        function toggleTheme() {
            var current = document.documentElement.getAttribute('data-theme');
            var next = current === 'dark' ? 'light' : 'dark';
            applyTheme(next);
            localStorage.setItem('admin-theme', next);
        }

        // Sidebar
        function toggleSidebar(expand) {
            var drawer = document.getElementById('main-drawer');
            var expandBtn = document.getElementById('sidebar-expand');
            var isOpen = drawer.classList.contains('lg:drawer-open');

            if (expand === true || (!expand && !isOpen)) {
                drawer.classList.add('lg:drawer-open');
                if (expandBtn) expandBtn.classList.add('hidden');
                localStorage.setItem('admin-sidebar', 'open');
            } else {
                drawer.classList.remove('lg:drawer-open');
                if (expandBtn) expandBtn.classList.remove('hidden');
                localStorage.setItem('admin-sidebar', 'collapsed');
            }
        }

        // Restore state on load
        (function() {
            var savedTheme = localStorage.getItem('admin-theme') || 'light';
            applyTheme(savedTheme);

            var savedSidebar = localStorage.getItem('admin-sidebar');
            if (savedSidebar === 'collapsed') {
                var drawer = document.getElementById('main-drawer');
                var expandBtn = document.getElementById('sidebar-expand');
                drawer.classList.remove('lg:drawer-open');
                if (expandBtn) expandBtn.classList.remove('hidden');
            }
        })();

        // Event listeners
        document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
        document.getElementById('sidebar-collapse').addEventListener('click', function() { toggleSidebar(false); });
        document.getElementById('sidebar-expand').addEventListener('click', function() { toggleSidebar(true); });
    </script>

    <script src="~/dist/mvc-grid.js" asp-append-version="true"></script>
    @RenderSection("Scripts", false)
</body>
</html>
